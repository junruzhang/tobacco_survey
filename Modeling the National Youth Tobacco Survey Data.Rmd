---
title: "Modeling the National Youth Tobacco Survey Data"
author: "Junru Zhang"
date: "06/07/2020"
output: pdf_document
---
## Loading and Cleaning the Data
```{r}
smokeFile = "smokeDownload.RData"
if (!file.exists(smokeFile)) { download.file("https://github.com/junruzhang/tobacco_survey/blob/master/smokeDownload.RData", smokeFile)
 } 
(load(smokeFile))
```

The `smoke` object is a `data.frame` containing the data. The `smokeFormats` gives some explanation of the variables. The `colName` and `label` columns of `smokeFormats` contain variable names in `smoke` and descriptions respectively.

````{r}
smokeFormats[
smokeFormats[,'colName'] == 'chewing_tobacco_snuff_or', c('colName','label')]

# get rid of 9, 10 year olds and missing age and race
smokeSub = smoke[which(smoke$Age > 10 & !is.na(smoke$Race)), ] 
smokeSub$ageC = smokeSub$Age - 16
```

## Fitting a Generalized Linear Model

Consider the following model and set of results
```{r}
smokeModel = glm(chewing_tobacco_snuff_or ~ ageC + RuralUrban + Race + Sex,
data=smokeSub, family=binomial(link='logit'))
summary(smokeModel)
```
```{r smokeTable}
knitr::kable(summary(smokeModel)$coef, digits=3)
```

## Interpreting the Model

The smokeModel corresponds to 

$$
Y_i \sim Binomial(N_i, \mu_i)
$$


with the link function

$$
log(\frac{\mu_i}{1-\mu_i})=X_i\beta
$$

where the response $Y_i$ is the number of people who chew tobacco (failure) and the number of people who do not (success) out of a fixed number of trials given $X_i\\$
$N_i$ is the total number of people (trials) with the given $X_i\\$
$\mu_i$ is the proportion of the $N_i$ people who chew tobacco  $\\ \\$
Covariates $X_i$ includes$\\$ 
$X_{i1}$: age of individual i, = 0 if age = 16, otherwise = age of individual i $- 16$

$X_{i2}$: the residence area of individual i, = 1 if rural and = 0 if urban,

$X_{i3},..., X_{i7}$: the race of individual i, = 1 if race of individual i is black, hispanic, asian, native, pacific **respectively**, otherwise 0.

$X_{i8}$: the sex of individual i, = 1 if female, = 0 if male.


## Transforming the Data

The data were in the log scale before the transformation.
```{r smokeOdds, tidy=TRUE}
logOddsMat = cbind(est=smokeModel$coef, confint(smokeModel, level=0.99))
oddsMat = exp(logOddsMat)
oddsMat[1,] = oddsMat[1,] / (1+oddsMat[1,])
rownames(oddsMat)[1] = 'Baseline prob'
knitr::kable(oddsMat, digits=3)
```


It is worthy noting that estimate of `baseline prob` our estimated probability that a **16-year-old urban, white, male** has used chewing tobacco, snuff or dip at least once in the last 30 days. The confidence interval of baseline prob indicate that the true probability of white males who live in urban area of age 16 have used chewing tobacco, snuff or dip at least once in the last 30 days is between 5.1% and 7.6%.

## Exploring the Data

If American TV is to believed, chewing tobacco is popular among cowboys, and cowboys are white, male and live in rural areas. In the early 1980s, the only Asian woman ever on North American TV was Yoko Ono, and Yoko Ono lived in a city and was never seen chewing tobacco. Is it true that rural white males are the group most likely to use chewing tobacco, and there is reasonable certainty that less than 0.5% of ethnic-minority urban women and girls chew tobacco?

Let's manipulate the data to find out more!

```{r}
newData = data.frame(Sex = rep(c('M','F'), c(3,2)),
Race = c('white','white','hispanic','black','asian'),
ageC = 0, RuralUrban = rep(c('Rural','Urban'), c(1,4))) 
smokePred = as.data.frame(predict(smokeModel, newData, se.fit=TRUE, type='link'))[,1:2]
# a rough 99% confidence interval
smokePred$lower = smokePred$fit - 3*smokePred$se.fit
smokePred$upper = smokePred$fit + 3*smokePred$se.fit
smokePred

expSmokePred = exp(smokePred[,c('fit','lower','upper')])

knitr::kable(cbind(newData[,-3],1000*expSmokePred/(1+expSmokePred)), digits=1)
expSmokePred
```


According to the output, rural white males are the group most likely to use chewing tobacco since it has the highest probability of using chewing tobacco, which is 14.93%, among all groups that are listed. 

Ethnic-minority urban women and girls refers to the last two rows of the table output generated by the second-last line of code above. These two rows represent urban black females and urban asian females respectively. This implies that ethnic-minority urban women and girls have a total of $(\frac{2.3+2.4}{1000})=0.47$% chance of chewing tobacco, which is less than half of one percent (< 0.50%). 

Furthermore, the 99% confidence interval of urban black females is (1.3, 4.2), which means most likely the probability of chewing tobacco is between 0.13% and  0.42% (which does not include 0.5%). However, for urban asian females, the 99% confidence interval is (0.08%, 0.68%), which does include 0.5%, so the probability for them to chew tobacco **can excceed 0.5%**. 

Thus, there is only some certainty that less than half of one percent of ethnic-minority urban women and girls chew tobacco, but again, it might be more than 0.5%. Also note that we are also limited in that these results are for 16 year-olds and so should be cautious in our generalisations to the whole population.